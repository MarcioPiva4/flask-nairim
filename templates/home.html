<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‚Äî Sistema Imobili√°rio</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header class="navbar">
        <div class="container-header">
            <div class="logo">
                <a href="{{ url_for('home.home') }}"><img src="https://front-nairim-holding.vercel.app/logo.svg" alt="logo nairim holding"/></a>
            </div>
            <nav class="nav-links">
                <a href="{{ url_for('imoveis.listar_imoveis') }}">Im√≥veis</a>
                <a href="{{ url_for('proprietarios.listar_proprietarios') }}">Propriet√°rios</a>
                <a href="{{ url_for('imobiliarias.listar_imobiliarias') }}">Imobili√°rias</a>
                <a href="{{ url_for('categorias.listar_categorias') }}">Categorias</a>
                <a href="{{ url_for('usuarios.listar_usuarios') }}">Usu√°rios</a>
                <a href="{{ url_for('favoritos.listar_favoritos') }}">Favoritos</a>
                <a href="{{ url_for('visitas.listar_visitas') }}">Visitas</a>
                <a href="{{ url_for('avaliacoes.listar_avaliacoes') }}">Avalia√ß√µes</a>
                <a href="{{ url_for('reclamacoes.listar_reclamacoes') }}">Reclama√ß√µes</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <h1>Bem-vindo √† Nairim Holding</h1>
        <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
        <a href="{{ url_for('home.gerar_relatorio_pdf') }}" 
        class="btn btn-primary btn-gerarrelatorio">
        üìÑ Gerar Relat√≥rio PDF
        </a>
    </div>

    </div>

    <div class="dashboard">
        <div class="card">
            <h2>Im√≥veis por Categoria</h2>
            <div id="grafico-categorias" class="plot"></div>
        </div>

        <div class="card">
            <h2>Im√≥veis por Imobili√°ria</h2>
            <div id="grafico-imobiliarias" class="plot"></div>
        </div>

        <div class="card">
            <h2>Pre√ßo M√©dio por Imobili√°ria</h2>
            <div id="grafico-preco-medio" class="plot"></div>
        </div>

        <div class="card">
            <h2>Usu√°rios por Tipo</h2>
            <div id="grafico-usuarios-tipo" class="plot"></div>
        </div>

        <div class="card">
            <h2>Im√≥veis por Propriet√°rio</h2>
            <div id="grafico-proprietarios" class="plot"></div>
        </div>

        <div class="card">
            <h2>Visitas por Im√≥vel</h2>
            <div id="grafico-visitas-imovel" class="plot"></div>
        </div>

        <div class="card">
            <h2>Visitas por Usu√°rio</h2>
            <div id="grafico-visitas-usuario" class="plot"></div>
        </div>
    </div>

    <script>
        async function carregarDados() {
            const resposta = await fetch('/api/dashboard-data');
            const dados = await resposta.json();

            Plotly.newPlot("grafico-categorias", [{
                labels: dados.imoveis_por_categoria.map(d => d.categoria),
                values: dados.imoveis_por_categoria.map(d => d.total),
                type: "pie",
                hole: 0.4
            }], {title: "Distribui√ß√£o por Categoria"});

            Plotly.newPlot("grafico-imobiliarias", [{
                x: dados.imoveis_por_imobiliaria.map(d => d.imobiliaria),
                y: dados.imoveis_por_imobiliaria.map(d => d.total),
                type: "bar",
                marker: {color: "royalblue"}
            }], {title: "Quantidade de Im√≥veis", xaxis: {title: "Imobili√°ria"}, yaxis: {title: "Total"}});

            Plotly.newPlot("grafico-preco-medio", [{
                x: dados.preco_medio_por_imobiliaria.map(d => d.imobiliaria),
                y: dados.preco_medio_por_imobiliaria.map(d => d.preco_medio),
                type: "line",
                line: {color: "green", width: 3}
            }], {title: "Pre√ßo M√©dio (R$)", xaxis: {title: "Imobili√°ria"}, yaxis: {title: "Pre√ßo M√©dio"}});

            Plotly.newPlot("grafico-usuarios-tipo", [{
                labels: dados.usuarios_por_tipo.map(d => d.tipo),
                values: dados.usuarios_por_tipo.map(d => d.total),
                type: "pie"
            }], {title: "Distribui√ß√£o de Usu√°rios"});

            Plotly.newPlot("grafico-proprietarios", [{
                x: dados.imoveis_por_proprietario.map(d => d.proprietario),
                y: dados.imoveis_por_proprietario.map(d => d.total),
                type: "bar",
                orientation: "h",
                marker: {color: "orange"}
            }], {title: "Im√≥veis por Propriet√°rio", xaxis: {title: "Total"}});

            Plotly.newPlot("grafico-visitas-imovel", [{
                x: dados.visitas_por_imovel.map(d => d.imovel),
                y: dados.visitas_por_imovel.map(d => d.total),
                type: "bar",
                marker: {color: "teal"}
            }], {title: "Visitas por Im√≥vel", xaxis: {title: "Im√≥vel"}, yaxis: {title: "Visitas"}});

            Plotly.newPlot("grafico-visitas-usuario", [{
                x: dados.visitas_por_usuario.map(d => d.usuario),
                y: dados.visitas_por_usuario.map(d => d.total),
                type: "bar",
                orientation: "h",
                marker: {color: "purple"}
            }], {title: "Visitas por Usu√°rio", xaxis: {title: "Visitas"}});
        }

        carregarDados();
    </script>
</body>
</html>
